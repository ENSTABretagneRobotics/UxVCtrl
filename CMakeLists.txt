cmake_minimum_required(VERSION 3.14...3.25)

#if(POLICY CMP0053)
#cmake_policy(SET CMP0053 OLD)
#endif()
set(ProgramFilesx86 "ProgramFiles(x86)")

#if(POLICY CMP0076)
#cmake_policy(SET CMP0076 OLD)
#endif()

set(CMAKE_TLS_VERIFY OFF)

project(UxVCtrl)

if(NOT(PROJECT_BINARY_DIR STREQUAL PROJECT_SOURCE_DIR))
	message(WARNING "Please set the CMake build folder to the same as the source folder if possible...")
	message(WARNING "Ensure also the working directory at runtime is UxVCtrl folder...")
endif()

option(OPENCV2413 "OPENCV2413" OFF)
option(OPENCV320 "OPENCV320" OFF)
option(OPENCV342 "OPENCV342" OFF)
option(OPENCV420 "OPENCV420" OFF)
option(OPENCV454 "OPENCV454" ON)
option(OPENCV460 "OPENCV460" ON)

option(RPLIDARSDK1120 "RPLIDARSDK1120" OFF)
option(RPLIDARSDK200 "RPLIDARSDK200" ON)

if(WIN32)
	if(NOT DEFINED ARCH)
		# First attempt to guess...
		if(CMAKE_SIZEOF_VOID_P EQUAL 8)
			set(ARCH "x64")
		elseif(CMAKE_SIZEOF_VOID_P EQUAL 4)
			set(ARCH "x86")
		else()
			message(WARNING "Unknown architecture, please try to set manually ARCH and RUNTIME variables...")
		endif()
		if(MSVC)
			# Get cl target bitness
			if("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "x64")
				set(ARCH "x64")
			elseif("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "Win64")
				set(ARCH "x64")
			elseif("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "x86")
				set(ARCH "x86")
			elseif("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "Win32")
				set(ARCH "x86")
			elseif("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "ARM64")
				set(ARCH "ARM64")
			elseif("${CMAKE_GENERATOR_PLATFORM}" STREQUAL "ARM")
				set(ARCH "ARM")
			endif()
		endif()
	endif()
	if(NOT DEFINED RUNTIME)
		if(MSVC)
			if(MSVC_TOOLSET_VERSION EQUAL 80)
				set(RUNTIME "vc8")
			elseif(MSVC_TOOLSET_VERSION EQUAL 90)
				set(RUNTIME "vc9")
			elseif(MSVC_TOOLSET_VERSION EQUAL 100)
				set(RUNTIME "vc10")
			elseif(MSVC_TOOLSET_VERSION EQUAL 110)
				set(RUNTIME "vc11")
			elseif(MSVC_TOOLSET_VERSION EQUAL 120)
				set(RUNTIME "vc12")
			elseif(MSVC_TOOLSET_VERSION EQUAL 140)
				set(RUNTIME "vc14")
			elseif(MSVC_TOOLSET_VERSION EQUAL 141)
				set(RUNTIME "vc15")
			elseif(MSVC_TOOLSET_VERSION EQUAL 142)
				set(RUNTIME "vc16")
			elseif(MSVC_TOOLSET_VERSION EQUAL 143)
				set(RUNTIME "vc17")
			elseif(MSVC_TOOLSET_VERSION EQUAL 144)
				set(RUNTIME "vc18")
			else()
				message(WARNING "Unknown Visual Studio compiler, please try to set manually ARCH and RUNTIME variables...")
				set(RUNTIME "vc10") # MSVC_TOOLSET_VERSION not set probably because an old version of CMake on XP with hopefully the latest Visual Studio for XP...
			endif()
		elseif(MINGW)
			set(RUNTIME "mingw")
		else()
			message(WARNING "Unknown compiler, please try to set manually ARCH and RUNTIME variables...")
		endif()
	endif()
else()
	if(NOT DEFINED ARCH)
	    # CMAKE_SYSTEM_PROCESSOR...?
		if(CMAKE_SIZEOF_VOID_P EQUAL 8)
			set(ARCH "x86_64")
		elseif(CMAKE_SIZEOF_VOID_P EQUAL 4)
			set(ARCH "i386")
		else()
			message(WARNING "Unknown architecture, please try to set manually ARCH and USR_LIB_ARCH_DIR variables...")
		endif()
	endif()
	if(NOT DEFINED USR_LIB_ARCH_DIR)
		if(APPLE)
			set(USR_LIB_ARCH_DIR "/usr/local/lib")
		else()
			if("${ARCH}" STREQUAL "x86_64")
				set(USR_LIB_ARCH_DIR "/usr/lib/${ARCH}-linux-gnu")
			elseif("${ARCH}" STREQUAL "i386")
				set(USR_LIB_ARCH_DIR "/usr/lib/${ARCH}-linux-gnu")
			else()
				message(WARNING "Unknown architecture, please try to set manually ARCH and USR_LIB_ARCH_DIR variables...")
				set(USR_LIB_ARCH_DIR "/usr/lib")
			endif()
		endif()
	endif()
endif()

if(WIN32 AND ((NOT DEFINED LIBPREFIXRUNTIME) OR (NOT DEFINED LIBEXTRUNTIME)))
	if(MSVC)
		set(LIBPREFIXRUNTIME "")
		set(LIBEXTRUNTIME ".lib")
	elseif(MINGW)
		set(LIBPREFIXRUNTIME "lib")
		set(LIBEXTRUNTIME ".dll.a")
	else()
		message(WARNING "Please try to set manually LIBPREFIXRUNTIME and LIBEXTRUNTIME variables...")
	endif()
endif()

option(ENABLE_AUTO_DOWNLOAD "ENABLE_AUTO_DOWNLOAD" ON)
if(WIN32)
	#set(SUDO_COMMAND "elevate" CACHE STRING "SUDO_COMMAND")
	set(INSTALL_PKG_COMMAND "choco install -y -r --no-progress" CACHE STRING "INSTALL_PKG_COMMAND")
	set(OPENCV_PKG_NAME "opencv --package-parameters '/Environment:C:\\tools\\opencv\\build'" CACHE STRING "OPENCV_PKG_NAME")
	#set(OPENCV_PKG_NAME "libopencv-dev" CACHE STRING "OPENCV_PKG_NAME")
	#set(LIBMODBUS_PKG_NAME "libmodbus" CACHE STRING "LIBMODBUS_PKG_NAME")
	set(LIBMODBUS_PKG_PREFIX "$ENV{ProgramFiles}" CACHE STRING "LIBMODBUS_PKG_PREFIX")
	set(FFMPEG_PKG_PREFIX "$ENV{ProgramFiles}" CACHE STRING "FFMPEG_PKG_PREFIX")
	set(MAVLINK_PKG_PREFIX "$ENV{ProgramFiles}" CACHE STRING "MAVLINK_PKG_PREFIX")
	set(SBG_SDK_PKG_PREFIX "$ENV{ProgramFiles}" CACHE STRING "SBG_SDK_PKG_PREFIX")
	set(RPLIDAR_SDK_PKG_PREFIX "$ENV{ProgramFiles}" CACHE STRING "RPLIDAR_SDK_PKG_PREFIX")
	option(ENABLE_FIND_PACKAGE_OPENCV "ENABLE_FIND_PACKAGE_OPENCV" OFF)
	option(ENABLE_FIND_PACKAGE_LIBFREENECT2 "ENABLE_FIND_PACKAGE_LIBFREENECT2" OFF)
elseif(APPLE)
	set(SUDO_COMMAND "sudo" CACHE STRING "SUDO_COMMAND")
	set(INSTALL_PKG_COMMAND "brew install" CACHE STRING "INSTALL_PKG_COMMAND")
	set(OPENCV_PKG_NAME "opencv" CACHE STRING "OPENCV_PKG_NAME")
	set(LIBMODBUS_PKG_NAME "libmodbus" CACHE STRING "LIBMODBUS_PKG_NAME")
	set(LIBMODBUS_PKG_PREFIX "/usr/local" CACHE STRING "LIBMODBUS_PKG_PREFIX")
	set(FFMPEG_PKG_NAME "ffmpeg" CACHE STRING "FFMPEG_PKG_NAME")
	set(FFMPEG_PKG_PREFIX "/usr/local" CACHE STRING "FFMPEG_PKG_PREFIX")
	set(MAVLINK_PKG_PREFIX "/usr/local" CACHE STRING "MAVLINK_PKG_PREFIX")
	set(SBG_SDK_PKG_PREFIX "/usr/local" CACHE STRING "SBG_SDK_PKG_PREFIX")
	set(RPLIDAR_SDK_PKG_PREFIX "/usr/local" CACHE STRING "RPLIDAR_SDK_PKG_PREFIX")
	option(ENABLE_FIND_PACKAGE_OPENCV "ENABLE_FIND_PACKAGE_OPENCV" ON)
	option(ENABLE_FIND_PACKAGE_LIBFREENECT2 "ENABLE_FIND_PACKAGE_LIBFREENECT2" ON)
else()
	set(SUDO_COMMAND "sudo" CACHE STRING "SUDO_COMMAND")
	set(INSTALL_PKG_COMMAND "sudo apt-get -y install" CACHE STRING "INSTALL_PKG_COMMAND")
	set(OPENCV_PKG_NAME "libopencv-dev" CACHE STRING "OPENCV_PKG_NAME")
	set(LIBMODBUS_PKG_NAME "libmodbus-dev" CACHE STRING "LIBMODBUS_PKG_NAME")
	set(LIBMODBUS_PKG_PREFIX "/usr/local" CACHE STRING "LIBMODBUS_PKG_PREFIX")
	set(FFMPEG_PKG_NAME "libavcodec-dev" CACHE STRING "FFMPEG_PKG_NAME")
	set(FFMPEG_PKG_PREFIX "/usr/local" CACHE STRING "FFMPEG_PKG_PREFIX")
	set(MAVLINK_PKG_PREFIX "/usr/local" CACHE STRING "MAVLINK_PKG_PREFIX")
	set(SBG_SDK_PKG_PREFIX "/usr/local" CACHE STRING "SBG_SDK_PKG_PREFIX")
	set(RPLIDAR_SDK_PKG_PREFIX "/usr/local" CACHE STRING "RPLIDAR_SDK_PKG_PREFIX")
	set(LIBFREENECT2_PREREQ_PKG_NAME "libusb-1.0-0-dev libturbojpeg0-dev libglfw3-dev" CACHE STRING "LIBFREENECT2_PREREQ_PKG_NAME")
	option(ENABLE_FIND_PACKAGE_OPENCV "ENABLE_FIND_PACKAGE_OPENCV" ON)
	option(ENABLE_FIND_PACKAGE_LIBFREENECT2 "ENABLE_FIND_PACKAGE_LIBFREENECT2" ON)
endif()
option(ENABLE_STATIC "ENABLE_STATIC" OFF)
if(ENABLE_STATIC)
set(STATIC_PREFIX "static" CACHE STRING "STATIC_PREFIX")
endif()

if(ENABLE_AUTO_DOWNLOAD)
	if(WIN32)
		message(STATUS "If behind a proxy, you might need to type e.g. \"set https_proxy=192.168.1.17:8080\" in the same terminal before running cmake-gui/cmake to configure the proxy settings...")
	else()
		message(STATUS "If behind a proxy, you might need to type e.g. \"export https_proxy=192.168.1.17:8080\" in the same terminal before running cmake-gui/cmake to configure the proxy settings...")
	endif()
	message(STATUS "If some prerequisites cannot be downloaded and installed automatically, try to install them manually and change ENABLE_AUTO_DOWNLOAD option in cmake-gui/cmake...")
endif()

if(ENABLE_AUTO_DOWNLOAD)
	if(NOT EXISTS "${PROJECT_SOURCE_DIR}/../OSUtils")
		message(STATUS "Downloading OSUtils...")
		file(DOWNLOAD "https://github.com/ENSTABretagneRobotics/OSUtils/archive/master.zip" "${PROJECT_SOURCE_DIR}/../OSUtils.zip")
		execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/../OSUtils.zip")
		execute_process(COMMAND ${CMAKE_COMMAND} -E rename "${PROJECT_SOURCE_DIR}/OSUtils-master" "${PROJECT_SOURCE_DIR}/../OSUtils")
		execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/../OSUtils.zip")
	endif()
	if(NOT EXISTS "${PROJECT_SOURCE_DIR}/../Extensions")
		message(STATUS "Downloading Extensions...")
		file(DOWNLOAD "https://github.com/ENSTABretagneRobotics/Extensions/archive/master.zip" "${PROJECT_SOURCE_DIR}/../Extensions.zip")
		execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/../Extensions.zip")
		execute_process(COMMAND ${CMAKE_COMMAND} -E rename "${PROJECT_SOURCE_DIR}/Extensions-master" "${PROJECT_SOURCE_DIR}/../Extensions")
		execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/../Extensions.zip")
	endif()
	if(NOT EXISTS "${PROJECT_SOURCE_DIR}/../interval")
		message(STATUS "Downloading interval...")
		file(DOWNLOAD "https://github.com/ENSTABretagneRobotics/interval/archive/master.zip" "${PROJECT_SOURCE_DIR}/../interval.zip")
		execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/../interval.zip")
		execute_process(COMMAND ${CMAKE_COMMAND} -E rename "${PROJECT_SOURCE_DIR}/interval-master" "${PROJECT_SOURCE_DIR}/../interval")
		execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/../interval.zip")
	endif()
	if(NOT EXISTS "${PROJECT_SOURCE_DIR}/../matrix_lib")
		message(STATUS "Downloading matrix_lib...")
		file(DOWNLOAD "https://github.com/ENSTABretagneRobotics/matrix_lib/archive/master.zip" "${PROJECT_SOURCE_DIR}/../matrix_lib.zip")
		execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/../matrix_lib.zip")
		execute_process(COMMAND ${CMAKE_COMMAND} -E rename "${PROJECT_SOURCE_DIR}/matrix_lib-master" "${PROJECT_SOURCE_DIR}/../matrix_lib")
		execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/../matrix_lib.zip")
	endif()
endif()

add_executable(UxVCtrl Observer.cpp NMEAInterface.cpp Main.cpp Globals.cpp Controller.cpp Config.cpp Computations.cpp Commands.cpp Hardware/ublox.cpp Hardware/RS232Port.cpp Hardware/RazorAHRS.cpp Hardware/Pololu.cpp Hardware/NMEADevice.cpp Hardware/I2CBus.cpp Hardware/gpControl.cpp ../interval/imatrix.cpp ../interval/rmatrix.cpp ../interval/box.cpp ../interval/interval.cpp ../interval/iboolean.cpp ../OSUtils/OSTimer.c ../OSUtils/OSTime.c ../OSUtils/OSThread.c ../OSUtils/OSSem.c ../OSUtils/OSNet.c ../OSUtils/OSMisc.c ../OSUtils/OSEv.c ../OSUtils/OSCriticalSection.c ../OSUtils/OSCore.c ../OSUtils/OSComputerRS232Port.c ../OSUtils/OSComputerI2CBus.c)

include_directories("${PROJECT_SOURCE_DIR}")
include_directories("${PROJECT_SOURCE_DIR}/../OSUtils")
include_directories("${PROJECT_SOURCE_DIR}/../Extensions/Img")
include_directories("${PROJECT_SOURCE_DIR}/../Extensions/Misc")
include_directories("${PROJECT_SOURCE_DIR}/../Extensions/Net")
include_directories("${PROJECT_SOURCE_DIR}/../interval")
include_directories("${PROJECT_SOURCE_DIR}/../matrix_lib")
include_directories("${PROJECT_SOURCE_DIR}/Hardware")
include_directories("${PROJECT_SOURCE_DIR}/..")

option(_DEBUG "_DEBUG" OFF)
option(_DEBUG_DISPLAY "_DEBUG_DISPLAY" OFF)
option(_DEBUG_MESSAGES "_DEBUG_MESSAGES" OFF)
option(_DEBUG_WARNINGS "_DEBUG_WARNINGS" OFF)
if(NOT MSVC)
	option(ENABLE_VALGRIND_DEBUG "ENABLE_VALGRIND_DEBUG" OFF)
endif()

option(ENABLE_CVKINECT2SDKHOOK "ENABLE_CVKINECT2SDKHOOK" OFF)
if(WIN32)
	option(USE_LIBFREENECT2 "USE_LIBFREENECT2" OFF)
	option(ENABLE_CVCLEYESDKHOOK "ENABLE_CVCLEYESDKHOOK" OFF)
else()
	option(USE_LIBFREENECT2 "USE_LIBFREENECT2" ON)
endif()
option(ENABLE_BLUEVIEW_SUPPORT "ENABLE_BLUEVIEW_SUPPORT" OFF)
option(ENABLE_MAVLINK_SUPPORT "ENABLE_MAVLINK_SUPPORT" OFF)
option(ENABLE_LABJACK_SUPPORT "ENABLE_LABJACK_SUPPORT" OFF)
option(ENABLE_LIBMODBUS_SUPPORT "ENABLE_LIBMODBUS_SUPPORT" OFF)
option(ENABLE_SBG_SDK_SUPPORT "ENABLE_SBG_SDK_SUPPORT" OFF)
option(DISABLE_SBG_TCP "DISABLE_SBG_TCP" OFF)
option(ENABLE_RPLIDAR_SDK_SUPPORT "ENABLE_RPLIDAR_SDK_SUPPORT" OFF)
if(RPLIDARSDK1120)
	option(FORCE_RPLIDAR_SDK_V1 "FORCE_RPLIDAR_SDK_V1" ON)
else()
	option(FORCE_RPLIDAR_SDK_V1 "FORCE_RPLIDAR_SDK_V1" OFF)
endif()
option(DISABLE_OPENCV_SUPPORT "DISABLE_OPENCV_SUPPORT" ON)

option(ENABLE_BUILD_OPTIMIZATION_SAILBOAT "ENABLE_BUILD_OPTIMIZATION_SAILBOAT" OFF)
option(USE_OPENCV_HIGHGUI_CPP_API "USE_OPENCV_HIGHGUI_CPP_API" OFF)
option(DISABLE_OPENCV_C_API_CTORS "DISABLE_OPENCV_C_API_CTORS" OFF)
if(WIN32)
	option(ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND "ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND" OFF)
	option(FORCE_SINGLE_THREAD_OPENCVGUI "FORCE_SINGLE_THREAD_OPENCVGUI" OFF)
else()
	option(ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND "ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND" ON)
	option(FORCE_SINGLE_THREAD_OPENCVGUI "FORCE_SINGLE_THREAD_OPENCVGUI" ON)
endif()
option(ENABLE_OPENCV_HIGHGUI_STARTWINDOWTHREAD "ENABLE_OPENCV_HIGHGUI_STARTWINDOWTHREAD" OFF)
option(ENABLE_SHARED_WAITKEY_OPENCVGUI "ENABLE_SHARED_WAITKEY_OPENCVGUI" OFF)
option(USE_FFMPEG_VIDEO "USE_FFMPEG_VIDEO" OFF)
option(DISABLE_AIS_SUPPORT "DISABLE_AIS_SUPPORT" OFF)
if(APPLE)
	option(USE_OLD_CHRONO "USE_OLD_CHRONO" ON)
	option(USE_OLD_TIMER "USE_OLD_TIMER" ON)
	option(ENABLE_COMPUTERI2CBUS_SUPPORT "ENABLE_COMPUTERI2CBUS_SUPPORT" OFF)
else()
	option(USE_OLD_CHRONO "USE_OLD_CHRONO" OFF)
	option(USE_OLD_TIMER "USE_OLD_TIMER" OFF)
	option(ENABLE_COMPUTERI2CBUS_SUPPORT "ENABLE_COMPUTERI2CBUS_SUPPORT" ON)
endif()
if(MINGW)
	option(ENABLE_MINGW64_STDCALL_FIX "ENABLE_MINGW64_STDCALL_FIX" OFF)
endif()

mark_as_advanced(SUDO_COMMAND INSTALL_PKG_COMMAND OPENCV_PKG_NAME LIBMODBUS_PKG_NAME LIBMODBUS_PKG_PREFIX FFMPEG_PKG_NAME FFMPEG_PKG_PREFIX MAVLINK_PKG_PREFIX SBG_SDK_PKG_PREFIX RPLIDAR_SDK_PKG_PREFIX LIBFREENECT2_PREREQ_PKG_NAME _DEBUG _DEBUG_DISPLAY _DEBUG_MESSAGES _DEBUG_WARNINGS ENABLE_VALGRIND_DEBUG USE_LIBFREENECT2 ENABLE_CVCLEYESDKHOOK ENABLE_BUILD_OPTIMIZATION_SAILBOAT USE_OPENCV_HIGHGUI_CPP_API DISABLE_OPENCV_C_API_CTORS ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND ENABLE_OPENCV_HIGHGUI_STARTWINDOWTHREAD ENABLE_SHARED_WAITKEY_OPENCVGUI USE_FFMPEG_VIDEO DISABLE_AIS_SUPPORT ENABLE_COMPUTERI2CBUS_SUPPORT)

if(ENABLE_BUILD_OPTIMIZATION_SAILBOAT)
	add_definitions(-D ENABLE_BUILD_OPTIMIZATION_SAILBOAT)
endif()

if(ENABLE_BLUEVIEW_SUPPORT)
	add_definitions(-D ENABLE_BLUEVIEW_SUPPORT)
	target_sources(UxVCtrl PUBLIC Hardware/BlueView.cpp) 
	if(WIN32)
		add_definitions(-D BVTSDK_VERSION=4)
		set(BVTSDK_DIR "$ENV{ProgramFiles}/BlueView/bvtsdk")
		if(ENABLE_AUTO_DOWNLOAD)
			if(NOT EXISTS "${BVTSDK_DIR}/include/bvt_sdk.h")
				message(STATUS "Downloading BlueView...")
				file(DOWNLOAD "http://download.microsoft.com/download/C/6/D/C6D0FD4E-9E53-4897-9B91-836EBA2AACD3/vcredist_x86.exe" "${PROJECT_SOURCE_DIR}/vcredist_x86.exe")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND cmd /c vcredist_x86.exe /Q)
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/vcredist_x86.exe")
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					file(DOWNLOAD "http://download.microsoft.com/download/A/8/0/A80747C3-41BD-45DF-B505-E9710D2744E0/vcredist_x64.exe" "${PROJECT_SOURCE_DIR}/vcredist_x64.exe")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND cmd /c vcredist_x64.exe /Q)
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/vcredist_x64.exe")
				endif()
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/bv.zip" "${PROJECT_SOURCE_DIR}/bv.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/bv.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "$ENV{ProgramFiles}/BlueView")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/bv/bv_4.2.0.9526_win32/bvtsdk" "${BVTSDK_DIR}")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/bv")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/bv.zip")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/cmake_extra_tools.zip" "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c pathman /as "$ENV{ProgramFiles}\\BlueView\\bvtsdk\\x86\\vc15\\bin")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c "sleep 5")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/cmake_extra_tools")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
			endif()
		endif()
		include_directories("${BVTSDK_DIR}/include")
		if(MSVC)
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${BVTSDK_DIR}/x86/vc15/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		else()
			set(CMAKE_EXE_LINKER_FLAGS "-L\"${BVTSDK_DIR}/x86/vc15/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		endif()
		target_link_libraries(UxVCtrl bvtsdk4)
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "/usr/local/include/bvt_sdk.h") AND (NOT EXISTS "/usr/include/bvt_sdk.h"))
				message(STATUS "Downloading BlueView...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/bv.zip" "${PROJECT_SOURCE_DIR}/bv.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/bv.zip")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p /usr/local/include")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p /usr/local/lib")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p /usr/include")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p /usr/lib")
				if("${CMAKE_SIZEOF_VOID_P}" EQUAL "4")
					execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -R \"${PROJECT_SOURCE_DIR}/bv/bv_3.5.0.5861_Ubuntu32_16.04.2/bvtsdk/include/\"* /usr/local/include/")
					execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -R \"${PROJECT_SOURCE_DIR}/bv/bv_3.5.0.5861_Ubuntu32_16.04.2/bvtsdk/lib/\"* /usr/local/lib/")
				else()
					execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -R \"${PROJECT_SOURCE_DIR}/bv/bv_3.5.0.6257_Ubuntu64_16.04.2/bvtsdk/include/\"* /usr/local/include/")
					execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -R \"${PROJECT_SOURCE_DIR}/bv/bv_3.5.0.6257_Ubuntu64_16.04.2/bvtsdk/lib/\"* /usr/local/lib/")
				endif()
				execute_process(COMMAND sh -c "${SUDO_COMMAND} rm -f /usr/local/lib/libbvtsdk.so /usr/local/lib/libbvtsdk.so.3 /usr/local/lib/libbvtsdk.so.3.5")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} ln -s -f /usr/local/lib/libbvtsdk.so.3.5.0 /usr/local/lib/libbvtsdk.so")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} ln -s -f /usr/local/lib/libbvtsdk.so.3.5.0 /usr/local/lib/libbvtsdk.so.3")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} ln -s -f /usr/local/lib/libbvtsdk.so.3.5.0 /usr/local/lib/libbvtsdk.so.3.5")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} ln -s -f /usr/local/lib/libbv* /usr/lib/")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} chmod -R 777 /usr/local/include/bv*")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} chmod -R 777 /usr/local/lib/libbv*")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} chmod -R 777 /usr/lib/libbv*")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/bv")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/bv.zip")
			endif()
		endif()
		include_directories("/usr/local/include")
		target_link_libraries(UxVCtrl bvtsdk)
	endif()
else()
	if(WIN32)
		if(EXISTS "$ENV{ProgramFiles}/BlueView/bvtsdk/include/bvt_sdk.h")
			message(STATUS "BlueView has been detected, see ENABLE_BLUEVIEW_SUPPORT option to try to use it...")
		endif()
	else()
		if((EXISTS "/usr/local/include/bvt_sdk.h") OR (EXISTS "/usr/include/bvt_sdk.h"))
			message(STATUS "BlueView has been detected, see ENABLE_BLUEVIEW_SUPPORT option to try to use it...")
		endif()
	endif()
endif()

if(ENABLE_CVKINECT2SDKHOOK)
	add_definitions(-D ENABLE_CVKINECT2SDKHOOK)
	if(USE_LIBFREENECT2)
		add_definitions(-D USE_LIBFREENECT2)
		if(ENABLE_FIND_PACKAGE_LIBFREENECT2)
			find_package(freenect2 QUIET)
			find_package(GLFW3 QUIET)
			find_package(OpenGL QUIET)
			if(freenect2_VERSION VERSION_LESS "0.2")
				if(ENABLE_AUTO_DOWNLOAD)
					if(WIN32)
						message(WARNING "libfreenect2 might need to be installed manually and the freenect2_DIR CMake variable might need to be set to e.g. $HOME/freenect2/lib/cmake/freenect2 (might need also to remove PKG_CONFIG_FOUND part in libfreenect2-master\cmake_modules\FindLibUSB.cmake and FindGLFW3.cmake)...")
					elseif(APPLE)
						message(WARNING "libfreenect2 might need to be installed manually and the freenect2_DIR CMake variable might need to be set to e.g. $HOME/freenect2/lib/cmake/freenect2...")
					else()
						message(STATUS "Trying to download libfreenect2, run \"${SUDO_COMMAND} apt-get update\" before if needed and check if the terminal is asking for a password...")
						execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${LIBFREENECT2_PREREQ_PKG_NAME}")
						file(DOWNLOAD "https://github.com/OpenKinect/libfreenect2/archive/master.zip" "${PROJECT_SOURCE_DIR}/master.zip")
						execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/master.zip")
						execute_process(COMMAND sh -c "cd \"${PROJECT_SOURCE_DIR}/libfreenect2-master\" && cmake -DCMAKE_POLICY_VERSION_MINIMUM=3.5 . && make")
						execute_process(COMMAND sh -c "cd \"${PROJECT_SOURCE_DIR}/libfreenect2-master\" && ${SUDO_COMMAND} make install")
						execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/libfreenect2-master")
						execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/master.zip")
						find_package(freenect2 QUIET)
						find_package(GLFW3 QUIET)
						find_package(OpenGL QUIET)
					endif()
				endif()
			endif()
			include_directories(${freenect2_INCLUDE_DIR} ${GLFW3_INCLUDE_DIRS} ${flextGL_INCLUDE_DIRS})
			# See https://github.com/glfw/glfw/issues/1030...
			if(GLFW3_VERSION VERSION_GREATER "3.1.2")
				if(NOT GLFW3_LIBRARIES)
					set(GLFW3_LIBRARIES glfw)
				endif()
			endif()
			target_link_libraries(UxVCtrl ${freenect2_LIBRARIES} ${GLFW3_LIBRARIES} ${OPENGL_gl_LIBRARY})
		else()
			if((NOT EXISTS "$ENV{LIBFREENECT2_DIR}/include/libfreenect2/libfreenect2.hpp") AND (NOT EXISTS "/usr/local/include/libfreenect2/libfreenect2.hpp") AND (NOT EXISTS "/usr/include/libfreenect2/libfreenect2.hpp"))
				message(WARNING "libfreenect2 might need to be installed manually and the LIBFREENECT2_DIR environment variable might need to be set (might need also to remove PKG_CONFIG_FOUND part in libfreenect2-master\cmake_modules\FindLibUSB.cmake and FindGLFW3.cmake)...")
			endif()
			include_directories("$ENV{LIBFREENECT2_DIR}/include")
			if(MSVC)
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{LIBFREENECT2_DIR}/lib/\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{LIBFREENECT2_DIR}/lib/\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			target_link_libraries(UxVCtrl freenect2)
		endif()
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if(NOT EXISTS "$ENV{KINECTSDK20_DIR}/inc/Kinect.h")
				message(WARNING "Kinect v2 SDK might need to be installed manually and the KINECTSDK20_DIR environment variable might need to be set to e.g. C:\\Program Files\\Microsoft SDKs\\Kinect\\v2.0_1409\\...")
				message(STATUS "Downloading Kinect v2 SDK...")
				file(DOWNLOAD "http://download.microsoft.com/download/1/6/B/16B06F60-3B20-4FF2-B699-5E9B7962F9AE/VSU_4/vcredist_x86.exe" "${PROJECT_SOURCE_DIR}/vcredist_x86.exe")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND cmd /c vcredist_x86.exe /Q)
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/vcredist_x86.exe")
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					file(DOWNLOAD "http://download.microsoft.com/download/1/6/B/16B06F60-3B20-4FF2-B699-5E9B7962F9AE/VSU_4/vcredist_x64.exe" "${PROJECT_SOURCE_DIR}/vcredist_x64.exe")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND cmd /c vcredist_x64.exe /Q)
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/vcredist_x64.exe")
				endif()
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/KinectSDK-v2.0.zip" "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "$ENV{ProgramFiles}/Microsoft SDKs/Kinect")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0/v2.0_1409.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/v2.0_1409" "$ENV{ProgramFiles}/Microsoft SDKs/Kinect/v2.0_1409")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND cmd /c setx KINECTSDK20_DIR "$ENV{ProgramFiles}\\Microsoft SDKs\\Kinect\\v2.0_1409\\\\" /m ) # The SDK installer adds a '\' at the end, and setx sometimes uses this character to escape commas...
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					execute_process(COMMAND ${CMAKE_COMMAND} -E copy "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0/x64/Kinect20.dll" "$ENV{SystemRoot}/System32/Kinect20.dll")
					execute_process(COMMAND ${CMAKE_COMMAND} -E copy "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0/x86/Kinect20.dll" "$ENV{SystemRoot}/SysWOW64/Kinect20.dll")
				else()
					execute_process(COMMAND ${CMAKE_COMMAND} -E copy "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0/x86/Kinect20.dll" "$ENV{SystemRoot}/System32/Kinect20.dll")
				endif()
				file(DOWNLOAD "https://download.microsoft.com/download/E/6/8/E688A436-5937-41CB-AF76-498E99E19191/KinectRuntime-v2.2_1905.zip" "${PROJECT_SOURCE_DIR}/KinectRuntime-v2.2_1905.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/KinectRuntime-v2.2_1905.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/drivers/x64" COMMAND cmd /c pnputil -i -a kinectsensor.inf)
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/drivers" "${PROJECT_SOURCE_DIR}/v2.0_1409" "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/KinectRuntime-v2.2_1905.zip" "${PROJECT_SOURCE_DIR}/KinectSDK-v2.0.zip")
				include_directories("$ENV{ProgramFiles}/Microsoft SDKs/Kinect/v2.0_1409/inc")
				if(MSVC)
					set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{ProgramFiles}/Microsoft SDKs/Kinect/v2.0_1409/Lib/${ARCH}\" ${CMAKE_EXE_LINKER_FLAGS}")
				else()
					set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{ProgramFiles}/Microsoft SDKs/Kinect/v2.0_1409/Lib/${ARCH}\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			endif()
		else()
			if(NOT EXISTS "$ENV{KINECTSDK20_DIR}/inc/Kinect.h")
				message(WARNING "Kinect v2 SDK might need to be installed manually and the KINECTSDK20_DIR environment variable might need to be set to e.g. C:\\Program Files\\Microsoft SDKs\\Kinect\\v2.0_1409\\...")
			endif()
		endif()
		include_directories("$ENV{KINECTSDK20_DIR}/inc")
		if(MSVC)
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{KINECTSDK20_DIR}/Lib/${ARCH}\" ${CMAKE_EXE_LINKER_FLAGS}")
		else()
			set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{KINECTSDK20_DIR}/Lib/${ARCH}\" ${CMAKE_EXE_LINKER_FLAGS}")
		endif()
		target_link_libraries(UxVCtrl Kinect20)
	endif()
endif()

if(ENABLE_CVCLEYESDKHOOK)
	add_definitions(-D ENABLE_CVCLEYESDKHOOK)
	include_directories("$ENV{CLEYESDK_DIR}/Include")
	if(MSVC)
		set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{CLEYESDK_DIR}/Lib\" ${CMAKE_EXE_LINKER_FLAGS}")
	else()
		set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{CLEYESDK_DIR}/Lib\" ${CMAKE_EXE_LINKER_FLAGS}")
	endif()
	target_link_libraries(UxVCtrl CLEyeMulticam)
endif()

if(ENABLE_MAVLINK_SUPPORT)
	add_definitions(-D ENABLE_MAVLINK_SUPPORT)
	target_sources(UxVCtrl PUBLIC VectorNavInterface.cpp MAVLinkInterface.cpp Hardware/MAVLinkDevice.cpp)
	if(WIN32)
		set(MAVLINK_SDK_DIR "${MAVLINK_PKG_PREFIX}/MAVLinkSDK")
		if(ENABLE_AUTO_DOWNLOAD)
			if(NOT EXISTS "${MAVLINK_PKG_PREFIX}/MAVLinkSDK/mavlink/common/mavlink.h")
				message(STATUS "Downloading mavlink...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/MAVLinkSDK.zip" "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/MAVLinkSDK" "${MAVLINK_SDK_DIR}")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/MAVLinkSDK")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
			endif()
		endif()
		include_directories("${MAVLINK_SDK_DIR}")
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "${MAVLINK_PKG_PREFIX}/include/mavlink/common/mavlink.h") AND (NOT EXISTS "/usr/include/mavlink/common/mavlink.h"))
				message(STATUS "Downloading mavlink...")
				#file(DOWNLOAD "https://github.com/mavlink/c_library_v2/archive/master.zip" "${PROJECT_SOURCE_DIR}/master.zip")
				#execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/master.zip")
				#execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p ${MAVLINK_PKG_PREFIX}/include")
				#execute_process(COMMAND sh -c "${SUDO_COMMAND} mv -f \"${PROJECT_SOURCE_DIR}/c_library_v2-master\" ${MAVLINK_PKG_PREFIX}/include/mavlink")
				#execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/master.zip")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/MAVLinkSDK.zip" "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p ${MAVLINK_PKG_PREFIX}/include")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mv -f \"${PROJECT_SOURCE_DIR}/MAVLinkSDK/mavlink\" ${MAVLINK_PKG_PREFIX}/include/mavlink")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/MAVLinkSDK")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/MAVLinkSDK.zip")
			endif()
		endif()
		include_directories("${MAVLINK_PKG_PREFIX}/include")
	endif()
else()
	if(WIN32)
		if(EXISTS "${MAVLINK_PKG_PREFIX}/MAVLinkSDK/mavlink/common/mavlink.h")
			message(STATUS "mavlink has been detected, see ENABLE_MAVLINK_SUPPORT option to try to use it...")
		endif()
	else()
		if((EXISTS "${MAVLINK_PKG_PREFIX}/include/mavlink/common/mavlink.h") OR (EXISTS "/usr/include/mavlink/common/mavlink.h"))
			message(STATUS "mavlink has been detected, see ENABLE_MAVLINK_SUPPORT option to try to use it...")
		endif()
	endif()
endif()

if(ENABLE_LABJACK_SUPPORT)
	add_definitions(-D ENABLE_LABJACK_SUPPORT)
	include_directories("${PROJECT_SOURCE_DIR}/../Extensions/Devices/LabjackUtils/UE9Utils")
	target_sources(UxVCtrl PUBLIC Hardware/UE9A.cpp ../Extensions/Devices/LabjackUtils/UE9Utils/UE9Cfg.c ../Extensions/Devices/LabjackUtils/UE9Utils/UE9Core.c)
	if(WIN32)
		set_source_files_properties(../Extensions/Devices/LabjackUtils/UE9Utils/UE9Cfg.c ../Extensions/Devices/LabjackUtils/UE9Utils/UE9Core.c PROPERTIES LANGUAGE CXX)
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "$ENV{ProgramFiles}/LabJack/Drivers/LabJackUD.h") AND (NOT EXISTS "$ENV{${ProgramFilesx86}}/LabJack/Drivers/LabJackUD.h"))
				message(STATUS "Downloading LabJack...")
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/LabJack-2019-05-20.zip" "${PROJECT_SOURCE_DIR}/LabJack.zip")
				else()
					file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/LabJack-2013.3.5.zip" "${PROJECT_SOURCE_DIR}/LabJack.zip")
				endif()
				#message(STATUS "LabJack downloaded!")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/LabJack.zip")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/cmake_extra_tools.zip" "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				#message(STATUS "LabJack extracted!")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/LabJack" COMMAND cmd /c "regedit /s Certificates.reg")
				#message(STATUS "Certificates OK!")
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/LabJack" COMMAND cmd /c "start LabJack-2019-05-20.exe /S")
				else()
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/LabJack" COMMAND cmd /c "start LabJack-2013.3.5.exe /S")
				endif()
				#message(STATUS "LabJack installing!")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c "sleep 60")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/LabJack" COMMAND cmd /c "TASKKILL /F /IM LVRunTimeEng.exe /T")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c "sleep 5")
				if("$ENV{PROCESSOR_ARCHITECTURE}" STREQUAL "AMD64")
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/LabJack-2019-05-20.exe")
				else()
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/LabJack-2013.3.5.exe")
				endif()
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/cmake_extra_tools")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/LabJack")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/LabJack.zip")
				#message(STATUS "LabJack installed!")
			endif()
		endif()
		if(NOT EXISTS "$ENV{ProgramFiles}/LabJack/Drivers/LabJackUD.h")
			include_directories("$ENV{${ProgramFilesx86}}/LabJack/Drivers")
			if(MSVC)
				if(ARCH STREQUAL "x64")
					set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{${ProgramFilesx86}}/LabJack/Drivers/64bit\" ${CMAKE_EXE_LINKER_FLAGS}")
				else()
					set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{${ProgramFilesx86}}/LabJack/Drivers\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			else()
				if(ARCH STREQUAL "x64")
					set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{${ProgramFilesx86}}/LabJack/Drivers/64bit\" ${CMAKE_EXE_LINKER_FLAGS}")
				else()
					set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{${ProgramFilesx86}}/LabJack/Drivers\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			endif()
		else()
			include_directories("$ENV{ProgramFiles}/LabJack/Drivers")
			if(MSVC)
				if(ARCH STREQUAL "x64")
					set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{ProgramFiles}/LabJack/Drivers/64bit\" ${CMAKE_EXE_LINKER_FLAGS}")
				else()
					set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{ProgramFiles}/LabJack/Drivers\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			else()
				if(ARCH STREQUAL "x64")
					set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{ProgramFiles}/LabJack/Drivers/64bit\" ${CMAKE_EXE_LINKER_FLAGS}")
				else()
					set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{ProgramFiles}/LabJack/Drivers\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			endif()
		endif()
		target_link_libraries(UxVCtrl labjackud)
	else()
		include_directories("${PROJECT_SOURCE_DIR}/../Extensions/Devices/LabjackUtils/liblabjackusb")
		target_sources(UxVCtrl PUBLIC ../Extensions/Devices/LabjackUtils/UE9Utils/ue9.c ../Extensions/Devices/LabjackUtils/liblabjackusb/labjackusb.c)
	endif()
endif()

if(ENABLE_LIBMODBUS_SUPPORT)
	add_definitions(-D ENABLE_LIBMODBUS_SUPPORT)
	target_sources(UxVCtrl PUBLIC Hardware/CISCREA.cpp)
	if(WIN32)
		if(ENABLE_AUTO_DOWNLOAD)
			if(NOT EXISTS "${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/include/modbus/modbus.h")
				message(STATUS "Downloading libmodbus...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/libmodbus-3.0.6-msvc.zip" "${PROJECT_SOURCE_DIR}/libmodbus-3.0.6-msvc.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/libmodbus-3.0.6-msvc.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/libmodbus-3.0.6-msvc" "${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/libmodbus-3.0.6-msvc")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/libmodbus-3.0.6-msvc.zip")
			endif()
		endif()
		include_directories("${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/include")
		if(MSVC)
			if(ENABLE_STATIC)
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			target_link_libraries(UxVCtrl debug libmodbus-3.0.6-msvcd)
			target_link_libraries(UxVCtrl optimized libmodbus-3.0.6-msvc)
		else()
			if(ENABLE_STATIC)
				#set(CMAKE_EXE_LINKER_FLAGS "-L\"${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			target_link_libraries(UxVCtrl modbus)
		endif()
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "/usr/include/modbus/modbus.h") AND (NOT EXISTS "${LIBMODBUS_PKG_PREFIX}/include/modbus/modbus.h"))
				if(APPLE)
					message(STATUS "Trying to download libmodbus...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${LIBMODBUS_PKG_NAME}")
				else()
					message(STATUS "Trying to download libmodbus, run \"${SUDO_COMMAND} apt-get update\" before if needed and check if the terminal is asking for a password...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${LIBMODBUS_PKG_NAME}")
				endif()
			endif()
		endif()
		set(CMAKE_EXE_LINKER_FLAGS "-L\"${LIBMODBUS_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		target_link_libraries(UxVCtrl modbus)
	endif()
else()
	if(WIN32)
		if(EXISTS "${LIBMODBUS_PKG_PREFIX}/libmodbus-3.0.6-msvc/include/modbus/modbus.h")
			message(STATUS "modbus has been detected, see ENABLE_LIBMODBUS_SUPPORT option to try to use it...")
		endif()
	else()
		if((EXISTS "/usr/include/modbus/modbus.h") OR (EXISTS "${LIBMODBUS_PKG_PREFIX}/include/modbus/modbus.h"))
			message(STATUS "modbus has been detected, see ENABLE_LIBMODBUS_SUPPORT option to try to use it...")
		endif()
	endif()
endif()

if(ENABLE_SBG_SDK_SUPPORT)
	add_definitions(-D ENABLE_SBG_SDK_SUPPORT)
	add_definitions(-D SBG_CONFIG_WARN_ABOUT_DEPRECATED_TYPES=0)
	if(WIN32)
		set(SBG_SDK_DIR "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/Software Development/sbgECom")
		if(ENABLE_AUTO_DOWNLOAD)
			if(((NOT EXISTS "${SBG_SDK_DIR}/common/sbgCommon.h") OR (NOT EXISTS "${SBG_SDK_DIR}/${ARCH}/vc15/lib/sbgECom.lib")) AND ((NOT EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/common/sbgCommon.h") OR (NOT EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/bin/sbgECom.lib")))
				message(STATUS "Downloading SBG SDK...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/SBG%20Systems.zip" "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/SBG Systems" "${SBG_SDK_PKG_PREFIX}/SBG Systems")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/SBG Systems")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
				#if(NOT EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/common/sbgCommon.h")
					#message(STATUS "Downloading SBG SDK...")
					#file(DOWNLOAD "https://github.com/lebarsfa/sbgECom/archive/refs/heads/enstabre.zip" "${PROJECT_SOURCE_DIR}/enstabre.zip")
					#execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/enstabre.zip")
					#execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/sbgECom-enstabre" "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library")
					#execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/sbgECom-enstabre")
					#execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/enstabre.zip")
				#endif()
				#execute_process(COMMAND ${CMAKE_COMMAND} -E make_directory "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/build")
				#if(MSVC)
					#if(ENABLE_STATIC)
						#execute_process(WORKING_DIRECTORY "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/build" COMMAND ${CMAKE_COMMAND} "-D CMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded$<$<CONFIG:Debug>:Debug> ..\\cmake")
					#else()
						#execute_process(WORKING_DIRECTORY "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/build" COMMAND ${CMAKE_COMMAND} "..\\cmake")
					#endif()
				#endif()
				#execute_process(WORKING_DIRECTORY "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/build" COMMAND ${CMAKE_COMMAND} "--build .")
			endif()
		endif()
		include_directories("${SBG_SDK_DIR}/common")
		include_directories("${SBG_SDK_DIR}/src")
		include_directories("${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/common")
		include_directories("${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/src")
		include_directories("${SBG_SDK_PKG_PREFIX}/common")
		include_directories("${SBG_SDK_PKG_PREFIX}/src")
		if(MSVC)
			if(ENABLE_STATIC)
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${SBG_SDK_DIR}/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${SBG_SDK_DIR}/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/bin\" ${CMAKE_EXE_LINKER_FLAGS}")
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${SBG_SDK_PKG_PREFIX}/bin\" ${CMAKE_EXE_LINKER_FLAGS}")
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${SBG_SDK_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			target_link_libraries(UxVCtrl debug sbgEComd)
			target_link_libraries(UxVCtrl optimized sbgECom)
		else()
			if(ENABLE_STATIC)
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_DIR}/${ARCH}/vc15/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_DIR}/${ARCH}/vc15/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/sbgECom Library/bin\" ${CMAKE_EXE_LINKER_FLAGS}")
			set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_PKG_PREFIX}/bin\" ${CMAKE_EXE_LINKER_FLAGS}")
			set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			target_link_libraries(UxVCtrl sbgECom)
		endif()
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if(((NOT EXISTS "${SBG_SDK_PKG_PREFIX}/include/sbgECom/common/sbgCommon.h") OR (NOT EXISTS "${SBG_SDK_PKG_PREFIX}/lib/libsbgECom.a")) AND 
			((NOT EXISTS "/usr/include/sbgECom/common/sbgCommon.h") OR (NOT EXISTS "/usr/lib/libsbgECom.a")))
				message(STATUS "Downloading SBG SDK...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/SBG%20Systems.zip" "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
				execute_process(COMMAND sh -c "cd \"${PROJECT_SOURCE_DIR}/SBG Systems/Inertial SDK/Software Development/sbgECom/projects/unix\" && cmake -DCMAKE_POLICY_VERSION_MINIMUM=3.5 . && cmake --build .")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p \"${SBG_SDK_PKG_PREFIX}/include/sbgECom\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p \"${SBG_SDK_PKG_PREFIX}/lib\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/SBG Systems/Inertial SDK/Software Development/sbgECom/src/\" \"${SBG_SDK_PKG_PREFIX}/include/sbgECom/src\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/SBG Systems/Inertial SDK/Software Development/sbgECom/common/\" \"${SBG_SDK_PKG_PREFIX}/include/sbgECom/common\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/SBG Systems/Inertial SDK/Software Development/sbgECom/bin/libsbgECom.a\" \"${SBG_SDK_PKG_PREFIX}/lib/libsbgECom.a\"")
				#execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/SBG Systems") # To keep the possibility to use "./SBG Systems" as installation folder
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/SBG Systems.zip")
			endif()
		endif()
		include_directories("${SBG_SDK_PKG_PREFIX}/include/sbgECom/common")
		include_directories("${SBG_SDK_PKG_PREFIX}/include/sbgECom/src")
		set(CMAKE_EXE_LINKER_FLAGS "-L\"${SBG_SDK_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		target_link_libraries(UxVCtrl sbgECom)
	endif()
	if(DISABLE_SBG_TCP)
		if(WIN32)
			if(EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/Software Development/sbgECom/common/interfaces/sbgInterfaceTcp.h")
				message(STATUS "TCP support in SBG SDK has been detected, see DISABLE_SBG_TCP option to try to use it...")
			endif()
		else()
			if((EXISTS "${SBG_SDK_PKG_PREFIX}/include/sbgECom/common/sbgInterfaceTcp.h") OR (EXISTS "/usr/include/sbgECom/common/sbgInterfaceTcp.h"))
				message(STATUS "TCP support in SBG SDK has been detected, see DISABLE_SBG_TCP option to try to use it...")
			endif()
		endif()
	else()
		if(WIN32)
			if(NOT EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/Software Development/sbgECom/common/interfaces/sbgInterfaceTcp.h")
				message(WARNING "TCP support in SBG SDK has not been detected, check DISABLE_SBG_TCP option...")
			endif()
		else()
			if((NOT EXISTS "${SBG_SDK_PKG_PREFIX}/include/sbgECom/common/sbgInterfaceTcp.h") AND (NOT EXISTS "/usr/include/sbgECom/common/sbgInterfaceTcp.h"))
				message(WARNING "TCP support in SBG SDK has not been detected, check DISABLE_SBG_TCP option...")
			endif()
		endif()
	endif()
else()
	if(WIN32)
		if(EXISTS "${SBG_SDK_PKG_PREFIX}/SBG Systems/Inertial SDK/Software Development/sbgECom/common/sbgCommon.h")
			message(STATUS "SBG SDK has been detected, see ENABLE_SBG_SDK_SUPPORT option to try to use it...")
		endif()
	else()
		if((EXISTS "${SBG_SDK_PKG_PREFIX}/include/sbgECom/common/sbgCommon.h") OR (EXISTS "/usr/include/sbgECom/common/sbgCommon.h"))
			message(STATUS "SBG SDK has been detected, see ENABLE_SBG_SDK_SUPPORT option to try to use it...")
		endif()
	endif()
endif()

if(ENABLE_RPLIDAR_SDK_SUPPORT)
	add_definitions(-D ENABLE_RPLIDAR_SDK_SUPPORT)
	if(RPLIDARSDK1120)
		set(RPLIDAR_SDK_REL_DIR "rplidar_sdk/sdk")
		set(RPLIDAR_SDK_DOWNLOAD_LINK "https://github.com/lebarsfa/rplidar_sdk/releases/download/release%2Fv1.12.0-enstabre/rplidar_sdk.zip")
		set(RPLIDAR_SDK_HDR_NAME "sl_lidar.h")
		if(WIN32)
			set(RPLIDAR_SDK_LIB_NAME "rplidar_driver")
		else()
			set(RPLIDAR_SDK_LIB_NAME "rplidar_sdk")
		endif()
	else()
		set(RPLIDAR_SDK_REL_DIR "rplidar_sdk")
		set(RPLIDAR_SDK_DOWNLOAD_LINK "https://github.com/lebarsfa/rplidar_sdk/releases/download/release%2Fv2.0.0-enstabre/rplidar_sdk.zip")
		set(RPLIDAR_SDK_HDR_NAME "rplidar.h")
		if(WIN32)
			set(RPLIDAR_SDK_LIB_NAME "rplidar_driver")
		else()
			set(RPLIDAR_SDK_LIB_NAME "sl_lidar_sdk")
		endif()
	endif()
	if(WIN32)
		if(ARCH STREQUAL "x64")
			set(RPLIDAR_SDK_RUNTIME "win64")
		else()
			set(RPLIDAR_SDK_RUNTIME "win32")
		endif()
	elseif(APPLE)
		set(RPLIDAR_SDK_RUNTIME "Darwin")
	else()
		set(RPLIDAR_SDK_RUNTIME "Linux")
	endif()
	if(WIN32)
		set(RPLIDAR_SDK_DIR "${RPLIDAR_SDK_PKG_PREFIX}/${RPLIDAR_SDK_REL_DIR}")
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "${RPLIDAR_SDK_DIR}/sdk/include/${RPLIDAR_SDK_HDR_NAME}") OR (NOT EXISTS "${RPLIDAR_SDK_DIR}/output/win32/Release/${RPLIDAR_SDK_LIB_NAME}.lib"))
				message(STATUS "Downloading RPLIDAR SDK...")
				file(DOWNLOAD "${RPLIDAR_SDK_DOWNLOAD_LINK}" "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/rplidar_sdk" "${RPLIDAR_SDK_PKG_PREFIX}/rplidar_sdk")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/rplidar_sdk")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
			endif()
		endif()
		include_directories("${RPLIDAR_SDK_DIR}/sdk/include")
		include_directories("${RPLIDAR_SDK_DIR}/sdk/src")
		if(MSVC)
			if(ENABLE_STATIC)
				#set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${RPLIDAR_SDK_DIR}/output/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${RPLIDAR_SDK_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				#set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${RPLIDAR_SDK_DIR}/output/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${RPLIDAR_SDK_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Debug\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			#target_link_libraries(UxVCtrl debug ${RPLIDAR_SDK_LIB_NAME}d)
			#target_link_libraries(UxVCtrl optimized ${RPLIDAR_SDK_LIB_NAME})
			target_link_libraries(UxVCtrl ${RPLIDAR_SDK_LIB_NAME})
		else()
			if(ENABLE_STATIC)
				#set(CMAKE_EXE_LINKER_FLAGS "-L\"${RPLIDAR_SDK_DIR}/output/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${RPLIDAR_SDK_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				#set(CMAKE_EXE_LINKER_FLAGS "-L\"${RPLIDAR_SDK_DIR}/output/${ARCH}/${RUNTIME}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "-L\"${RPLIDAR_SDK_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
			target_link_libraries(UxVCtrl ${RPLIDAR_SDK_LIB_NAME})
		endif()
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if(((NOT EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/include/${RPLIDAR_SDK_HDR_NAME}") OR (NOT EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/lib/lib${RPLIDAR_SDK_LIB_NAME}.a")) AND 
			((NOT EXISTS "/usr/include/${RPLIDAR_SDK_REL_DIR}/include/${RPLIDAR_SDK_HDR_NAME}") OR (NOT EXISTS "/usr/lib/lib${RPLIDAR_SDK_LIB_NAME}.a")))
				message(STATUS "Downloading RPLIDAR SDK...")
				file(DOWNLOAD "${RPLIDAR_SDK_DOWNLOAD_LINK}" "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
				if(APPLE)
					execute_process(COMMAND sh -c "cd \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}\" && rm -Rf output && SDKROOT=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk make")
				else()
					execute_process(COMMAND sh -c "cd \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}\" && rm -Rf output && make")
				endif()
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p \"${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/sdk\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p \"${RPLIDAR_SDK_PKG_PREFIX}/lib\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} mkdir -p \"${RPLIDAR_SDK_PKG_PREFIX}/bin\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}/sdk/include/\" \"${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/sdk/include\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}/sdk/src/\" \"${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/sdk/src\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release/lib${RPLIDAR_SDK_LIB_NAME}.a\" \"${RPLIDAR_SDK_PKG_PREFIX}/lib/lib${RPLIDAR_SDK_LIB_NAME}.a\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release/ultra_simple\" \"${RPLIDAR_SDK_PKG_PREFIX}/bin/ultra_simple\"")
				execute_process(COMMAND sh -c "${SUDO_COMMAND} cp -Rf \"${PROJECT_SOURCE_DIR}/${RPLIDAR_SDK_REL_DIR}/output/${RPLIDAR_SDK_RUNTIME}/Release/simple_grabber\" \"${RPLIDAR_SDK_PKG_PREFIX}/bin/simple_grabber\"")
				#execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/rplidar_sdk") # To keep the possibility to use "./rplidar_sdk" as installation folder
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/rplidar_sdk.zip")
			endif()
		endif()
		include_directories("${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/sdk/include")
		include_directories("${RPLIDAR_SDK_PKG_PREFIX}/include/${RPLIDAR_SDK_REL_DIR}/sdk/src")
		set(CMAKE_EXE_LINKER_FLAGS "-L\"${RPLIDAR_SDK_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		target_link_libraries(UxVCtrl ${RPLIDAR_SDK_LIB_NAME})
	endif()
else()
	if(WIN32)
		if(EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/rplidar_sdk/sdk/include/sl_lidar.h")
			message(STATUS "RPLIDAR SDK v2 has been detected, see ENABLE_RPLIDAR_SDK_SUPPORT and RPLIDARSDK200 options to try to use it...")
		elseif(EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/rplidar_sdk/sdk/sdk/include/rplidar.h")
			message(STATUS "RPLIDAR SDK v1 has been detected, see ENABLE_RPLIDAR_SDK_SUPPORT and RPLIDARSDK1120 options to try to use it...")
		endif()
	else()
		if((EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/include/rplidar_sdk/sdk/include/sl_lidar.h") OR (EXISTS "/usr/include/rplidar_sdk/sdk/include/sl_lidar.h"))
			message(STATUS "RPLIDAR SDK v2 has been detected, see ENABLE_RPLIDAR_SDK_SUPPORT and RPLIDARSDK200 options to try to use it...")
		elseif((EXISTS "${RPLIDAR_SDK_PKG_PREFIX}/include/rplidar_sdk/sdk/sdk/include/rplidar.h") OR (EXISTS "/usr/include/rplidar_sdk/sdk/sdk/include/rplidar.h"))
			message(STATUS "RPLIDAR SDK v1 has been detected, see ENABLE_RPLIDAR_SDK_SUPPORT and RPLIDARSDK1120 options to try to use it...")
		endif()
	endif()
endif()

if(OPENCV2413)
	set(OPENCV_VER_X_X_X "2.4.13")
	set(OPENCV_VER_X_X "2.4")
	set(OPENCV_VER_XXX "2413")
	set(OPENCV_VER_XX "24")
	set(OPENCV_VER_X "2")
elseif(OPENCV320)
	set(OPENCV_VER_X_X_X "3.2.0")
	set(OPENCV_VER_X_X "3.2")
	set(OPENCV_VER_XXX "320")
	set(OPENCV_VER_XX "32")
	set(OPENCV_VER_X "3")
elseif(OPENCV342)
	set(OPENCV_VER_X_X_X "3.4.2")
	set(OPENCV_VER_X_X "3.4")
	set(OPENCV_VER_XXX "342")
	set(OPENCV_VER_XX "34")
	set(OPENCV_VER_X "3")
elseif(OPENCV420)
	set(OPENCV_VER_X_X_X "4.2.0")
	set(OPENCV_VER_X_X "4.2")
	set(OPENCV_VER_XXX "420")
	set(OPENCV_VER_XX "42")
	set(OPENCV_VER_X "4")
elseif(OPENCV454)
	set(OPENCV_VER_X_X_X "4.5.4")
	set(OPENCV_VER_X_X "4.5")
	set(OPENCV_VER_XXX "454")
	set(OPENCV_VER_XX "45")
	set(OPENCV_VER_X "4")
elseif(OPENCV460)
	set(OPENCV_VER_X_X_X "4.6.0")
	set(OPENCV_VER_X_X "4.6")
	set(OPENCV_VER_XXX "460")
	set(OPENCV_VER_XX "46")
	set(OPENCV_VER_X "4")
endif()
if(DISABLE_OPENCV_SUPPORT)
	add_definitions(-D DISABLE_OPENCV_SUPPORT)
	find_package(OpenCV QUIET)
	if(OpenCV_FOUND)
		message(STATUS "OpenCV ${OpenCV_VERSION} has been detected, check DISABLE_OPENCV_SUPPORT and ENABLE_FIND_PACKAGE_OPENCV options to try to use it...")
	endif()
	if(WIN32)
		if(EXISTS "$ENV{SystemDrive}/OpenCV2.4.13/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_core2413${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 2.4.13 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV2413 options to try to use it...")
		endif()
		if(EXISTS "$ENV{SystemDrive}/OpenCV3.2.0/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world320${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 3.2.0 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV320 options to try to use it...")
		endif()
		if(EXISTS "$ENV{SystemDrive}/OpenCV3.4.2/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world342${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 3.4.2 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV342 options to try to use it...")
		endif()
		if(EXISTS "$ENV{SystemDrive}/OpenCV4.2.0/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world420${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 4.2.0 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV420 options to try to use it...")
		endif()
		if(EXISTS "$ENV{SystemDrive}/OpenCV4.5.4/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world454${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 4.5.4 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV454 options to try to use it...")
		endif()
		if(EXISTS "$ENV{SystemDrive}/OpenCV4.6.0/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world460${LIBEXTRUNTIME}")
			message(STATUS "OpenCV 4.6.0 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV460 options to try to use it...")
		endif()
	else()
		if((EXISTS "/usr/include/opencv2/core/version.hpp") OR (EXISTS "/usr/include/opencv4/opencv2/core/version.hpp") OR (EXISTS "/usr/local/include/opencv4/opencv2/core/version.hpp") OR (EXISTS "/usr/local/include/opencv4/opencv2/core/version.hpp"))
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.2.4.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.2.4") OR (EXISTS "/usr/local/lib/libopencv_core.so.2.4")))
				message(STATUS "OpenCV 2.4 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV2413 options to try to use it...")
			endif()
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.3.2.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.3.2") OR (EXISTS "/usr/local/lib/libopencv_core.so.3.2")))
				message(STATUS "OpenCV 3.2 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV320 options to try to use it...")
			endif()
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.3.4.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.3.4") OR (EXISTS "/usr/local/lib/libopencv_core.so.3.4")))
				message(STATUS "OpenCV 3.4 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV342 options to try to use it...")
			endif()
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.4.2.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.4.2") OR (EXISTS "/usr/local/lib/libopencv_core.so.4.2")))
				message(STATUS "OpenCV 4.2 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV420 options to try to use it...")
			endif()
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.4.5.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.4.5") OR (EXISTS "/usr/local/lib/libopencv_core.so.4.5")))
				message(STATUS "OpenCV 4.5 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV454 options to try to use it...")
			endif()
			if((APPLE AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.4.6.dylib")) OR ((NOT APPLE) AND (EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.4.6") OR (EXISTS "/usr/local/lib/libopencv_core.so.4.6")))
				message(STATUS "OpenCV 4.6 has been detected, see DISABLE_OPENCV_SUPPORT and OPENCV460 options to try to use it...")
			endif()
		endif()
	endif()
else()
	if(ENABLE_BUILD_OPTIMIZATION_SAILBOAT)
		target_sources(UxVCtrl PUBLIC Ball.cpp OpenCVGUI.cpp VideoRecord.cpp Hardware/Video.cpp)
	else()
		target_sources(UxVCtrl PUBLIC Ball.cpp ExternalVisualLocalization.cpp Obstacle.cpp OpenCVGUI.cpp Pinger.cpp SurfaceVisualObstacle.cpp VideoInterface.cpp VideoRecord.cpp Wall.cpp Hardware/Video.cpp)
	endif()
	if(ENABLE_FIND_PACKAGE_OPENCV)
		find_package(OpenCV QUIET)
		if(OpenCV_VERSION VERSION_LESS "2.0")
			if(ENABLE_AUTO_DOWNLOAD)
				if(WIN32)
					message(STATUS "Trying to download OpenCV...")
					execute_process(COMMAND "${INSTALL_PKG_COMMAND} ${OPENCV_PKG_NAME}")
					find_package(OpenCV QUIET)
				elseif(APPLE)
					message(STATUS "Trying to download OpenCV...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${OPENCV_PKG_NAME}")
					find_package(OpenCV QUIET)
				else()
					message(STATUS "Trying to download OpenCV, run \"${SUDO_COMMAND} apt-get update\" before if needed and check if the terminal is asking for a password...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${OPENCV_PKG_NAME}")
					find_package(OpenCV QUIET)
				endif()
			endif()
		endif()
		if(OpenCV_VERSION VERSION_LESS "2.0")
			message(WARNING "Check if ENABLE_FIND_PACKAGE_OPENCV option should be disabled to try to detect OpenCV...")
		else()
			if(OpenCV_VERSION VERSION_LESS "4")
			else()
				if(MSVC)
				else()
					set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11") # CMAKE_CXX_STANDARD does not seem to work on macOS...
				endif()
			endif()
			include_directories(${OpenCV_INCLUDE_DIRS})
			target_link_libraries(UxVCtrl ${OpenCV_LIBS})
		endif()
	else()
		if(WIN32)
			if(ENABLE_AUTO_DOWNLOAD)
				if((NOT EXISTS "$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_world${OPENCV_VER_XXX}${LIBEXTRUNTIME}") AND (NOT EXISTS "$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib/${LIBPREFIXRUNTIME}opencv_core${OPENCV_VER_XXX}${LIBEXTRUNTIME}"))
					message(STATUS "Downloading OpenCV ${OPENCV_VER_X_X_X}...")
					file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/OpenCV${OPENCV_VER_X_X_X}.zip" "${PROJECT_SOURCE_DIR}/OpenCV${OPENCV_VER_X_X_X}.zip")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/OpenCV${OPENCV_VER_X_X_X}.zip")
					execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/OpenCV${OPENCV_VER_X_X_X}" "$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}")
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/OpenCV${OPENCV_VER_X_X_X}")
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/OpenCV${OPENCV_VER_X_X_X}.zip")
					file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/cmake_extra_tools.zip" "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c reg add HKEY_LOCAL_MACHINE\\SOFTWARE\\Kitware\\CMake\\Packages\\OpenCV /v "OpenCV${OPENCV_VER_X_X_X}" /d "%SystemDrive%\\\\OpenCV${OPENCV_VER_X_X_X}" /f)
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c pathman /as "$ENV{SystemDrive}\\OpenCV${OPENCV_VER_X_X_X}\\${ARCH}\\${RUNTIME}\\bin")
					execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c "sleep 5")
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/cmake_extra_tools")
					execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				endif()
			endif()
			include_directories("$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}/include")
			if(OPENCV_VER_X_X_X VERSION_LESS "4")
			else()
				#add_definitions(-D USE_OPENCV_HIGHGUI_CPP_API)
				if(MSVC)
				else()
					set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
				endif()
			endif()
			if(MSVC)
				set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{SystemDrive}/OpenCV${OPENCV_VER_X_X_X}/${ARCH}/${RUNTIME}/${STATIC_PREFIX}lib\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
		else()
			if(ENABLE_AUTO_DOWNLOAD)
				if((NOT EXISTS "/usr/include/opencv2/core/version.hpp") AND (NOT EXISTS "/usr/include/opencv4/opencv2/core/version.hpp") AND (NOT EXISTS "/usr/local/include/opencv4/opencv2/core/version.hpp") AND (NOT EXISTS "/usr/local/include/opencv4/opencv2/core/version.hpp"))
					if(APPLE)
						message(STATUS "Trying to download OpenCV...")
						execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${OPENCV_PKG_NAME}")
					else()
						message(STATUS "Trying to download OpenCV, run \"${SUDO_COMMAND} apt-get update\" before if needed and check if the terminal is asking for a password...")
						execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${OPENCV_PKG_NAME}")
					endif()
				endif()
			endif()
			if((APPLE AND (NOT EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.${OPENCV_VER_X_X}.dylib")) OR ((NOT APPLE) AND ((NOT EXISTS "${USR_LIB_ARCH_DIR}/libopencv_core.so.${OPENCV_VER_X_X}") AND (NOT EXISTS "/usr/local/lib/libopencv_core.so.${OPENCV_VER_X_X}"))))
				message(WARNING "In case of problems, check if OPENCVXXX options should be changed...")
			endif()
			if(OPENCV_VER_X_X_X VERSION_LESS "4")
				if(APPLE)
					include_directories("/usr/local/opt/opencv@${OPENCV_VER_X}/include")
					set(CMAKE_EXE_LINKER_FLAGS "-L\"/usr/local/opt/opencv@${OPENCV_VER_X}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
			else()
				if(APPLE)
					include_directories("/usr/local/opt/opencv@${OPENCV_VER_X}/include/opencv${OPENCV_VER_X}")
					set(CMAKE_EXE_LINKER_FLAGS "-L\"/usr/local/opt/opencv@${OPENCV_VER_X}/lib\" -L\"/usr/local/opt/opencv@${OPENCV_VER_X}/lib/opencv${OPENCV_VER_X}/3rdparty\" ${CMAKE_EXE_LINKER_FLAGS}")
				endif()
				include_directories("/usr/local/include/opencv${OPENCV_VER_X}")
				set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11") 
				set(CMAKE_EXE_LINKER_FLAGS "-L\"/usr/local/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
				set(CMAKE_EXE_LINKER_FLAGS "-L\"/usr/local/lib/opencv${OPENCV_VER_X}/3rdparty\" ${CMAKE_EXE_LINKER_FLAGS}")
			endif()
		endif()
		if(ENABLE_STATIC)
			if(OPENCV_VER_X_X_X VERSION_LESS "3.0")
				if(WIN32)
					if(MSVC)
						target_link_libraries(UxVCtrl debug opencv_core${OPENCV_VER_XXX}d debug opencv_imgproc${OPENCV_VER_XXX}d debug opencv_highgui${OPENCV_VER_XXX}d debug IlmImfd debug zlibd debug libjasperd debug libjpegd debug libpngd debug libtiffd debug vfw32 debug comctl32)
						target_link_libraries(UxVCtrl optimized opencv_core${OPENCV_VER_XXX} optimized opencv_imgproc${OPENCV_VER_XXX} optimized opencv_highgui${OPENCV_VER_XXX} optimized IlmImf optimized zlib optimized libjasper optimized libjpeg optimized libpng optimized libtiff optimized vfw32 optimized comctl32)
					else()
						target_link_libraries(UxVCtrl opencv_core${OPENCV_VER_XXX} opencv_imgproc${OPENCV_VER_XXX} opencv_highgui${OPENCV_VER_XXX} IlmImf libjasper libjpeg libpng libtiff zlib vfw32 gdi32 uuid oleaut32 ole32 comctl32 comdlg32)
					endif()
				else()
					target_link_libraries(UxVCtrl opencv_core opencv_imgproc opencv_highgui IlmImf libjasper libjpeg libpng libtiff zlib)
				endif()
			elseif(OPENCV_VER_X_X_X VERSION_LESS "3.3")
				if(WIN32)
					if(MSVC)
						target_link_libraries(UxVCtrl debug opencv_world${OPENCV_VER_XXX}d debug libwebpd debug IlmImfd debug zlibd debug libjasperd debug libjpegd debug libpngd debug libtiffd debug vfw32 debug comctl32)
						target_link_libraries(UxVCtrl optimized opencv_world${OPENCV_VER_XXX} optimized libwebp optimized IlmImf optimized zlib optimized libjasper optimized libjpeg optimized libpng optimized libtiff optimized vfw32 optimized comctl32)
						target_link_libraries(UxVCtrl ippicvmt)
					else()
						target_link_libraries(UxVCtrl opencv_world${OPENCV_VER_XXX} libwebp IlmImf libjasper libjpeg libpng libtiff zlib vfw32 gdi32 uuid oleaut32 ole32 comctl32 comdlg32)
					endif()
				else()
					target_link_libraries(UxVCtrl opencv_core opencv_imgproc opencv_highgui opencv_imgcodecs opencv_videoio libwebp IlmImf libjasper libjpeg libpng libtiff zlib)
				endif()
			elseif(OPENCV_VER_X_X_X VERSION_LESS "4.0")
				if(WIN32)
					if(MSVC)
						target_link_libraries(UxVCtrl debug opencv_highgui${OPENCV_VER_XXX}d debug opencv_videoio${OPENCV_VER_XXX}d debug opencv_imgcodecs${OPENCV_VER_XXX}d debug opencv_imgproc${OPENCV_VER_XXX}d debug opencv_core${OPENCV_VER_XXX}d debug libwebp debug ippiwd debug ittnotifyd debug libprotobufd debug IlmImfd debug zlibd debug libjasperd debug libjpeg-turbod debug libpngd debug libtiffd debug vfw32 debug comctl32)
						target_link_libraries(UxVCtrl optimized opencv_highgui${OPENCV_VER_XXX} optimized opencv_videoio${OPENCV_VER_XXX} optimized opencv_imgcodecs${OPENCV_VER_XXX} optimized opencv_imgproc${OPENCV_VER_XXX} optimized opencv_core${OPENCV_VER_XXX} optimized libwebp optimized ippiw optimized ittnotify optimized libprotobuf optimized IlmImf optimized zlib optimized libjasper optimized libjpeg-turbo optimized libpng optimized libtiff optimized vfw32 optimized comctl32)
						target_link_libraries(UxVCtrl ippicvmt)
					else()
						set(CMAKE_EXE_LINKER_FLAGS "-L\"$ENV{SystemDrive}/OpenCV3.4.2/${ARCH}/${RUNTIME}/staticlib\" ${CMAKE_EXE_LINKER_FLAGS}")
						target_link_libraries(UxVCtrl opencv_highgui${OPENCV_VER_XXX} opencv_videoio${OPENCV_VER_XXX} opencv_imgcodecs${OPENCV_VER_XXX} opencv_imgproc${OPENCV_VER_XXX} opencv_core${OPENCV_VER_XXX} IlmImf libjasper libjpeg-turbo libpng libprotobuf libtiff libwebp zlib vfw32 gdi32 uuid oleaut32 ole32 comctl32 comdlg32)
					endif()
				else()
					target_link_libraries(UxVCtrl opencv_highgui opencv_videoio opencv_imgcodecs opencv_imgproc opencv_core IlmImf libjasper libjpeg-turbo libpng libprotobuf libtiff libwebp zlib)
				endif()
			elseif(OPENCV_VER_X_X_X VERSION_LESS "4.3")
				if(WIN32)
					if(MSVC)
						target_link_libraries(UxVCtrl debug opencv_highgui${OPENCV_VER_XXX}d debug opencv_videoio${OPENCV_VER_XXX}d debug opencv_imgcodecs${OPENCV_VER_XXX}d debug opencv_imgproc${OPENCV_VER_XXX}d debug opencv_core${OPENCV_VER_XXX}d debug libwebpd debug ippiwd debug ittnotifyd debug libprotobufd debug IlmImfd debug zlibd debug libjasperd debug libjpeg-turbod debug libpngd debug libtiffd debug vfw32 debug comctl32)
						target_link_libraries(UxVCtrl optimized opencv_highgui${OPENCV_VER_XXX} optimized opencv_videoio${OPENCV_VER_XXX} optimized opencv_imgcodecs${OPENCV_VER_XXX} optimized opencv_imgproc${OPENCV_VER_XXX} optimized opencv_core${OPENCV_VER_XXX} optimized libwebp optimized ippiw optimized ittnotify optimized libprotobuf optimized IlmImf optimized zlib optimized libjasper optimized libjpeg-turbo optimized libpng optimized libtiff optimized vfw32 optimized comctl32)
						target_link_libraries(UxVCtrl ippicvmt)
					else()
						target_link_libraries(UxVCtrl opencv_highgui${OPENCV_VER_XXX} opencv_videoio${OPENCV_VER_XXX} opencv_imgcodecs${OPENCV_VER_XXX} opencv_imgproc${OPENCV_VER_XXX} opencv_core${OPENCV_VER_XXX} ade quirc libwebp libprotobuf IlmImf zlib libjasper libjpeg-turbo libpng libtiff vfw32 gdi32 uuid oleaut32 ole32 comctl32 comdlg32)
					endif()
				else()
					target_link_libraries(UxVCtrl opencv_highgui opencv_videoio opencv_imgcodecs opencv_imgproc opencv_core ade quirc ippiw ittnotify ippicv libprotobuf)
				endif()
			else()
				if(WIN32)
					if(MSVC)
						target_link_libraries(UxVCtrl debug opencv_highgui${OPENCV_VER_XXX}d debug opencv_videoio${OPENCV_VER_XXX}d debug opencv_imgcodecs${OPENCV_VER_XXX}d debug opencv_imgproc${OPENCV_VER_XXX}d debug opencv_core${OPENCV_VER_XXX}d debug libwebpd debug ippiwd debug ittnotifyd debug libprotobufd debug IlmImfd debug zlibd debug libopenjp2d debug libjpeg-turbod debug libpngd debug libtiffd debug vfw32 debug comctl32)
						target_link_libraries(UxVCtrl optimized opencv_highgui${OPENCV_VER_XXX} optimized opencv_videoio${OPENCV_VER_XXX} optimized opencv_imgcodecs${OPENCV_VER_XXX} optimized opencv_imgproc${OPENCV_VER_XXX} optimized opencv_core${OPENCV_VER_XXX} optimized libwebp optimized ippiw optimized ittnotify optimized libprotobuf optimized IlmImf optimized zlib optimized libopenjp2 optimized libjpeg-turbo optimized libpng optimized libtiff optimized vfw32 optimized comctl32)
						target_link_libraries(UxVCtrl ippicvmt)
					else()
						target_link_libraries(UxVCtrl opencv_highgui${OPENCV_VER_XXX} opencv_videoio${OPENCV_VER_XXX} opencv_imgcodecs${OPENCV_VER_XXX} opencv_imgproc${OPENCV_VER_XXX} opencv_core${OPENCV_VER_XXX} ade quirc libwebp libprotobuf IlmImf zlib libopenjp2 libjpeg-turbo libpng libtiff vfw32 gdi32 uuid oleaut32 ole32 comctl32 comdlg32)
					endif()
				else()
					target_link_libraries(UxVCtrl opencv_highgui opencv_videoio opencv_imgcodecs opencv_imgproc opencv_core ade quirc ippiw ittnotify ippicv libprotobuf libopenjp2)
				endif()
			endif()
		else()
			if(WIN32)
				if(MSVC)
					if(OPENCV_VER_X VERSION_LESS "3")
						target_link_libraries(UxVCtrl debug opencv_core${OPENCV_VER_XXX}d debug opencv_imgproc${OPENCV_VER_XXX}d debug opencv_highgui${OPENCV_VER_XXX}d)
						target_link_libraries(UxVCtrl optimized opencv_core${OPENCV_VER_XXX} optimized opencv_imgproc${OPENCV_VER_XXX} optimized opencv_highgui${OPENCV_VER_XXX})
					else()
						target_link_libraries(UxVCtrl debug opencv_world${OPENCV_VER_XXX}d)
						target_link_libraries(UxVCtrl optimized opencv_world${OPENCV_VER_XXX})
					endif()
				else()
					if(OPENCV_VER_X VERSION_LESS "3")
						target_link_libraries(UxVCtrl opencv_core${OPENCV_VER_XXX} opencv_imgproc${OPENCV_VER_XXX} opencv_highgui${OPENCV_VER_XXX})
					else()
						target_link_libraries(UxVCtrl opencv_world${OPENCV_VER_XXX})
					endif()
				endif()
			else()
				if(OPENCV_VER_X VERSION_LESS "3")
					target_link_libraries(UxVCtrl opencv_core opencv_imgproc opencv_highgui)
				else()
					target_link_libraries(UxVCtrl opencv_highgui opencv_videoio opencv_imgcodecs opencv_imgproc opencv_core)
					#opencv_core opencv_imgproc opencv_highgui opencv_imgcodecs opencv_videoio
				endif()
			endif()
		endif()
	endif()
endif()

if(USE_FFMPEG_VIDEO)
	add_definitions(-D USE_FFMPEG_VIDEO)
	if(WIN32)
		if(ENABLE_AUTO_DOWNLOAD)
			if(NOT EXISTS "${FFMPEG_PKG_PREFIX}/ffmpeg-msvc/include/libavcodec/avcodec.h")
				message(STATUS "Downloading ffmpeg-msvc...")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/ffmpeg-msvc.zip" "${PROJECT_SOURCE_DIR}/ffmpeg-msvc.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/ffmpeg-msvc.zip")
				execute_process(COMMAND ${CMAKE_COMMAND} -E copy_directory "${PROJECT_SOURCE_DIR}/ffmpeg-msvc" "${FFMPEG_PKG_PREFIX}/ffmpeg-msvc")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/ffmpeg-msvc")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/ffmpeg-msvc.zip")
				file(DOWNLOAD "http://webperso.ensta.fr/lebars/Share/cmake_extra_tools.zip" "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}" COMMAND ${CMAKE_COMMAND} -E tar xfz "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c pathman /as "${FFMPEG_PKG_PREFIX}\\ffmpeg-msvc\\${ARCH}\\vc15\\bin")
				execute_process(WORKING_DIRECTORY "${PROJECT_SOURCE_DIR}/cmake_extra_tools" COMMAND cmd /c "sleep 5")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove_directory "${PROJECT_SOURCE_DIR}/cmake_extra_tools")
				execute_process(COMMAND ${CMAKE_COMMAND} -E remove "${PROJECT_SOURCE_DIR}/cmake_extra_tools.zip")
			endif()
		endif()
		include_directories("${FFMPEG_PKG_PREFIX}/ffmpeg-msvc/include")
		if(MSVC)
			set(CMAKE_EXE_LINKER_FLAGS "/LIBPATH:\"${FFMPEG_PKG_PREFIX}/ffmpeg-msvc/${ARCH}/vc15/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		else()
			set(CMAKE_EXE_LINKER_FLAGS "-L\"${FFMPEG_PKG_PREFIX}/ffmpeg-msvc/${ARCH}/vc15/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		endif()
		target_link_libraries(UxVCtrl avcodec avdevice avfilter avformat avutil postproc swresample swscale)
	else()
		if(ENABLE_AUTO_DOWNLOAD)
			if((NOT EXISTS "/usr/include/libavcodec/avcodec.h") AND (NOT EXISTS "${FFMPEG_PKG_PREFIX}/include/libavcodec/avcodec.h"))
				if(APPLE)
					message(STATUS "Trying to download ffmpeg...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${FFMPEG_PKG_NAME}")
				else()
					message(STATUS "Trying to download ffmpeg, run \"${SUDO_COMMAND} apt-get update\" before if needed and check if the terminal is asking for a password...")
					execute_process(COMMAND sh -c "${INSTALL_PKG_COMMAND} ${FFMPEG_PKG_NAME}")
				endif()
			endif()
		endif()
		set(CMAKE_EXE_LINKER_FLAGS "-L\"${FFMPEG_PKG_PREFIX}/lib\" ${CMAKE_EXE_LINKER_FLAGS}")
		target_link_libraries(UxVCtrl avcodec avformat avutil swresample swscale)
	endif()
else()
	if(WIN32)
		if(EXISTS "${FFMPEG_PKG_PREFIX}/ffmpeg-msvc/include/libavcodec/avcodec.h")
			message(STATUS "ffmpeg-msvc has been detected, see USE_FFMPEG_VIDEO option to try to use it...")
		endif()
	else()
		if((EXISTS "/usr/include/libavcodec/avcodec.h") OR (EXISTS "${FFMPEG_PKG_PREFIX}/include/libavcodec/avcodec.h"))
			message(STATUS "ffmpeg has been detected, see USE_FFMPEG_VIDEO option to try to use it...")
		endif()
	endif()
endif()

if(_DEBUG)
	add_definitions(-D _DEBUG)
endif()

if(_DEBUG_DISPLAY)
	add_definitions(-D _DEBUG_DISPLAY)
endif()

if(_DEBUG_MESSAGES)
	add_definitions(-D _DEBUG_MESSAGES)
endif()

if(_DEBUG_WARNINGS)
	add_definitions(-D _DEBUG_WARNINGS)
endif()

if(NOT MSVC)
	if(ENABLE_VALGRIND_DEBUG)
		add_definitions(-D ENABLE_VALGRIND_DEBUG)
	endif()
endif()

if(ENABLE_BUILD_OPTIMIZATION_SAILBOAT)
else()
	target_sources(UxVCtrl PUBLIC SSC32Interface.cpp SonarLocalization.cpp SonarAltitudeEstimation.cpp Simulator.cpp SeanetProcessing.cpp SBGInterface.cpp RoboteqInterface.cpp RazorAHRSInterface.cpp PololuInterface.cpp FollowMe.cpp ExternalProgramTrigger.cpp Hardware/SwarmonDevice.cpp Hardware/SSC32.cpp Hardware/SRF02.cpp Hardware/Seanet.cpp Hardware/SBG.cpp Hardware/RPLIDAR.cpp Hardware/Roboteq.cpp Hardware/PathfinderDVL.cpp Hardware/P33x.cpp Hardware/Ontrak.cpp Hardware/NortekDVL.cpp Hardware/MT.cpp Hardware/ArduinoPressureSensor.cpp Hardware/MS580314BA.cpp Hardware/MS5837.cpp Hardware/MiniSSC.cpp Hardware/MES.cpp Hardware/MDM.cpp Hardware/LIRMIA3.cpp Hardware/Hokuyo.cpp Hardware/IM483I.cpp)
endif()

if(USE_OPENCV_HIGHGUI_CPP_API)
	add_definitions(-D USE_OPENCV_HIGHGUI_CPP_API)
endif()

if(DISABLE_OPENCV_C_API_CTORS)
	add_definitions(-D DISABLE_OPENCV_C_API_CTORS)
endif()

if(ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND)
	add_definitions(-D ENABLE_OPENCV_HIGHGUI_THREADS_WORKAROUND)
endif()

if(ENABLE_OPENCV_HIGHGUI_STARTWINDOWTHREAD)
	add_definitions(-D ENABLE_OPENCV_HIGHGUI_STARTWINDOWTHREAD)
endif()

if(FORCE_SINGLE_THREAD_OPENCVGUI)
	add_definitions(-D FORCE_SINGLE_THREAD_OPENCVGUI)
endif()

if(ENABLE_SHARED_WAITKEY_OPENCVGUI)
	add_definitions(-D ENABLE_SHARED_WAITKEY_OPENCVGUI)
endif()

if(DISABLE_SBG_TCP)
	add_definitions(-D DISABLE_SBG_TCP)
endif()

if(FORCE_RPLIDAR_SDK_V1)
	add_definitions(-D FORCE_RPLIDAR_SDK_V1)
endif()

if(DISABLE_AIS_SUPPORT)
	add_definitions(-D DISABLE_AIS_SUPPORT)
endif()

if(USE_OLD_CHRONO)
	add_definitions(-D USE_OLD_CHRONO)
endif()

if(USE_OLD_TIMER)
	add_definitions(-D USE_OLD_TIMER)
endif()

if(ENABLE_COMPUTERI2CBUS_SUPPORT)
	add_definitions(-D ENABLE_COMPUTERI2CBUS_SUPPORT)
endif()

# mingw64 does not seem to support _stdcall that appear in LabJackUD.h...
if(ENABLE_MINGW64_STDCALL_FIX)
	add_definitions(-D _stdcall=__stdcall)
endif()

if(WIN32)
	add_definitions(-D ENABLE_GETTIMEOFDAY_WIN32 -D DISABLE_TIMEZONE_STRUCT_REDEFINITION)
	add_definitions(-D ENABLE_CANCEL_THREAD -D ENABLE_KILL_THREAD)
endif()
add_definitions(-D SIMULATED_INTERNET_SWARMONDEVICE)

if(WIN32)
	if(MSVC)
		set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /W4")
		set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /W4")
		if(ENABLE_STATIC)
			if(CMAKE_VERSION VERSION_LESS 3.15.0)
				set(CMAKE_C_FLAGS_DEBUG "${CMAKE_C_FLAGS_DEBUG} /MTd")
				set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MTd")
				set(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} /MT")
				set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT")
			else()
				set_target_properties(UxVCtrl PROPERTIES MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
			endif()
		endif()
		target_link_libraries(UxVCtrl WinMM WS2_32)
	else()
		set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra")
		set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra -fpermissive")
		if(ENABLE_STATIC)
			set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -static-libgcc -static-libstdc++")
		endif()
		target_link_libraries(UxVCtrl WinMM WS2_32 m)
	endif()
else()
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra")
	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wno-unknown-pragmas -Wno-unused-parameter -Wextra -fpermissive")
	if(ENABLE_STATIC)
		if(NOT APPLE)
			set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -static-libgcc -static-libstdc++")
			if(DISABLE_OPENCV_SUPPORT)
				set(CMAKE_EXE_LINKER_FLAGS "-static ${CMAKE_EXE_LINKER_FLAGS}")
			else()
				# Adding -static would refuse any dynamic library left...
			endif()
		endif()
	endif()
	if(APPLE)
		target_link_libraries(UxVCtrl pthread m)
	else()
		target_link_libraries(UxVCtrl pthread rt m)
	endif()
endif()

if(WIN32)
	message(STATUS "You might need to update your PATH and reboot depending on the prerequisites installed so that UxVCtrl can always find the necessary binaries and libraries at runtime, you might need also to enable Media and .NET 2.0/3.0/3.5 features in Windows and install Visual Studio 2008-2022 Redistributable...")
else()
	message(STATUS "You might need to update your PATH/LD_LIBRARY_PATH and reboot depending on the prerequisites installed so that UxVCtrl can always find the necessary binaries and libraries at runtime...")
endif()
